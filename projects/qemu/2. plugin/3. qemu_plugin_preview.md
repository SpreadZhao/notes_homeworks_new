为了尽快入手plugin机制，我在王学长的帮助下首先测试了官方写好的一个例子。这个例子是qemu官方为了开发者能更好地利用plugin API从而实现的一些类。具体的参考网站如下：

[(29条消息) QEMU TCG Plugins详解_JaCenz的博客-CSDN博客](https://blog.csdn.net/JaCenz/article/details/125302647)

[QEMU TCG Plugins — QEMU documentation](https://www.qemu.org/docs/master/devel/tcg-plugins.html?highlight=plugin)

如今很多软件都采用`ninja`，`CMake`，`menson`等混合编译工具进行编译，qemu也不例外。在其中的`README`内就能看到相关说明：

```rst
QEMU is multi-platform software intended to be buildable on all modern
Linux platforms, OS-X, Win32 (via the Mingw64 toolchain) and a variety
of other UNIX targets. The simple steps to build QEMU are:


.. code-block:: shell

  mkdir build
  cd build
  ../configure
  make

```

所以我们要在`./build`目录下输出所有makefile编译好的文件。首先是进行配置，其实最简单来讲就是这个命令：

```shell
./configure
```

但是，我们需要在后面添加一些参数：

```shell
./configure --target-list=x86_64-softmmu --enable-plugins --enable-kvm --enable-debug-tcg
```

第一个是只编译x86架构，而不管arm之类的架构；第二个就是启用plugin功能；而kvm和tcg都是和qemu一起工作的一个小的虚拟化产品。

在所有的配置都写好之后，就可以开始编译了：

```shell
sudo make [-j8]
```

但是，在编译完成之后，我并没有在`./build/contrib/plugins/`目录下找到对应的`.so`文件。经过讨论，发现需要手动进行编译：

![[E9J(F8[$K2C93@UM[~[R4%K.png]]

在手动编译之后，执行安装命令，就可以使用qemu脚本去启动虚拟机了。

```shell
sudo make install
```

再之后的操作就显而易见了，我们对应plugin之中描述的功能，就能在命令行中看到对应的输出。有些是在翻译指令之前，有些是在翻译指令之后。

[QEMU翻译机制](https://www.qemu.org/docs/master/devel/tcg.html?highlight=translate)

