---
title: 3.1 Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€
chapter: "3"
order: "4"
---
### 3.1 Javaå†…å­˜æ¨¡å‹çš„åŸºç¡€

å¹¶å‘ç¼–ç¨‹æœ‰ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š

* çº¿ç¨‹çš„**é€šä¿¡**ï¼›
* çº¿ç¨‹çš„**åŒæ­¥**ã€‚

Javaä¸­ï¼Œé€šä¿¡ä½¿ç”¨çš„æ–¹å¼å°±æ˜¯å…±äº«å†…å­˜ã€‚æ—¢ç„¶æåˆ°å…±äº«å†…å­˜ï¼Œé‚£ä¹ˆå°±è¦çœ‹çœ‹Javaæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ã€‚ä¹Ÿå°±æ˜¯JMMï¼ˆ**Java** Memory Modelï¼‰ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ˜ç¡®ä¸€äº›ä¸œè¥¿ï¼š

> [!info]
> **çº¿ç¨‹ä¹‹é—´å…±äº«çš„**ï¼š
> 
> **å †å†…å­˜**é‡Œå­˜çš„ä¸œè¥¿ã€‚éƒ½æœ‰å•¥å‘¢ï¼Ÿæœ‰å®ä¾‹åŸŸï¼Œé™æ€åŸŸï¼Œæ•°ç»„å…ƒç´ ã€‚
> 
> ---
> 
> **çº¿ç¨‹ä¹‹é—´ä¸å…±äº«çš„**ï¼š
> 
> å±€éƒ¨å˜é‡ã€æ–¹æ³•å®šä¹‰å‚æ•°å’Œå¼‚å¸¸å¤„ç†å™¨å‚æ•°ã€‚


- [ ] #TODO è¿™äº›ç©æ„å„¿éƒ½æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŸæŸ¥ä¸€æŸ¥ã€‚å°±å…±äº«å’Œä¸å…±äº«é‚£äº›ã€‚ ğŸ”¼

#### 3.1.1 JMM

é‚£ä¹ˆå¦‚ä½•å®ç°å‘¢ï¼Ÿçœ‹çœ‹JMMæ¨¡å‹å…·ä½“æ˜¯ä»€ä¹ˆï¼š

![[Study Log/java_kotlin_study/resources/Pasted image 20231031231058.png]]

**æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸ªæœ¬åœ°çš„å†…å­˜ï¼Œè¿™é‡Œé¢å­˜ç€ä¸»å†…å­˜é‡Œå…±äº«å˜é‡çš„å‰¯æœ¬**ã€‚è¿™ä¸ªæœ¬åœ°å†…å­˜å°±æ˜¯ä¹‹å‰é‚£ç¯‡æ–‡ç« ï¼š[ä¸ºä»€ä¹ˆvolatileèƒ½ä¿è¯å¯è§æ€§ï¼Ÿvolitileä¸ºä»€ä¹ˆåªèƒ½ä¿è¯å¯è§æ€§-CSDNåšå®¢](https://blog.csdn.net/m0_37892106/article/details/97050278)é‡Œè¯´çš„å·¥ä½œå†…å­˜ï¼Œå¤§æ¦‚æ˜¯ã€‚

> [!warning]
> æ³¨æ„ï¼Œæœ¬åœ°å†…å­˜å®é™…ä¸Šä¸å­˜åœ¨ï¼Œåªæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ã€å†™ç¼“å†²åŒºã€å¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚

é‚£ä¹ˆè¿™æ ·å­ï¼Œçœ‹çœ‹ä¸€ä¸ªçº¿ç¨‹æ˜¯æ€ä¹ˆé€šçŸ¥å¦ä¸€ä¸ªçº¿ç¨‹çš„ï¼š

![[Study Log/java_kotlin_study/resources/Pasted image 20231031233508.png]]

è¿™é‡Œï¼Œå…ˆå‡è®¾ä¸‰ä¸ªå†…å­˜ä¸­çš„xéƒ½æ˜¯0ã€‚ç°åœ¨ï¼ŒAçº¿ç¨‹æ›´æ–°äº†ï¼ŒæŠŠxå˜æˆäº†1ï¼Œé‚£ä¹ˆä¹‹åï¼Œå¦‚æœAè¦é€šçŸ¥Bâ€œæˆ‘çš„xå·²ç»æ›´æ–°å•¦ï¼â€å°±è¦è¿™æ ·åšï¼š

1. Açº¿ç¨‹æŠŠxçš„æ–°å€¼1å†™åˆ°ä¸»å†…å­˜ä¸­ï¼›
2. Bçº¿ç¨‹ä»ä¸»å†…å­˜ä¸­è¯»åˆ°æ–°å€¼1ï¼Œå¹¶å†™åˆ°è‡ªå·±çš„æœ¬åœ°å†…å­˜ä¸­ã€‚

> [!summary] Summary
> 
> æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ï¼Œåœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œä¸¤ä¸ªçº¿ç¨‹é€šä¿¡çš„æ–¹å¼ï¼š
> 
> - çº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚
> - çº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹ A ä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚

Javaå¸®æˆ‘ä»¬å°è£…äº†è¿™ä¸ªå†…éƒ¨çš„å®ç°ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çœ‹æ¥å°±æ˜¯ä¸Šé¢è™šçº¿ç®­å¤´ä¸­çš„å†…å®¹ã€‚è€Œå®é™…ä¸Šåœ¨é€šä¿¡çš„å†…éƒ¨å·²ç»è¿›è¡Œäº†è¿™ç§å¯¹å†…å­˜çš„è¯»å†™è¿‡ç¨‹ã€‚è¿™ä¸ªé€šä¿¡å¿…é¡»ç»è¿‡ä¸»å†…å­˜ï¼Œ**JMMé€šè¿‡æ§åˆ¶==ä¸»å†…å­˜==ä¸æ¯ä¸ªçº¿ç¨‹çš„==æœ¬åœ°å†…å­˜==ä¹‹é—´çš„äº¤äº’ï¼Œæ¥ä¸ºJavaç¨‹åºå‘˜æä¾›==å†…å­˜å¯è§æ€§==ä¿è¯**ã€‚

#### 3.1.2 é‡æ’åºç®€ä»‹

æ¥ä¸‹æ¥ï¼Œçœ‹çœ‹æŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ã€‚è¿™é‡Œåªæ˜¯ç¨å¾®æä¸€ä¸‹ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚é‡æ’åºä¸»è¦åˆ†æˆ3ç§ï¼š

1. **ç¼–è¯‘å™¨ä¼˜åŒ–**é‡æ’åºï¼šç¼–è¯‘çš„æ—¶å€™ï¼Œåœ¨**ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰**çš„å‰æä¸‹ï¼Œé‡æ–°å®‰æ’ä»£ç çš„æ‰§è¡Œé¡ºåºï¼›
2. **æŒ‡ä»¤çº§å¹¶è¡Œ**çš„é‡æ’åºï¼šæŒ‡ä»¤çº§å¹¶è¡Œæˆ‘æ„Ÿè§‰å°±æ˜¯CPUçš„é‚£ä¸ªæµæ°´çº¿æŠ€æœ¯ï¼Œå¯ä»¥è®©å¤šæ¡æŒ‡ä»¤äº¤é”™æ‰§è¡Œï¼Œå°±æ˜¯å–æŒ‡è¯‘ç æ‰§è¡Œå†™å›é‚£ç§ï¼Œè®©å¤šä¸ªäººä¸€å—å¹²ï¼š[[Lecture Notes/Computer Structure/cs2#1. Pipe Line|cs2]]ï¼›
3. **å†…å­˜ç³»ç»Ÿ**é‡æ’åºï¼šä¸»è¦æ˜¯å¯¹IOæ“ä½œçš„ä¼˜åŒ–ã€‚ä½ æƒ³æƒ³ï¼ŒCPUæœ‰Cacheï¼Œç„¶ååšIOæ“ä½œçš„æ—¶å€™è¿˜æœ‰bufferè¿™æ ·çš„æ¦‚å¿µï¼Œé‚£ä¹ˆæœ‰äº†è¿™äº›ä¸œè¥¿ï¼Œå¤„ç†æŸäº›æŒ‡ä»¤çš„æ—¶å€™å°±å¯ä»¥ä¹±åºæ‰§è¡Œäº†ã€‚å› ä¸ºæœ‰ç¼“å­˜å…œç€ï¼Œæ²¡å¿…è¦æ—¶æ—¶åˆ»åˆ»ä¸ºäº†ä¿æŒé¡ºåºè€Œæ”¾å¼ƒæ€§èƒ½ã€‚

ä»Javaæºä»£ç åˆ°æœ€ç»ˆæ‰§è¡Œï¼Œé‡æ’åºå¤§æ¦‚çš„é¡ºåºæ˜¯è¿™æ ·çš„ï¼š

![[Study Log/java_kotlin_study/resources/Pasted image 20231104002137.png]]

è¿™äº›é‡æ’åºä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ã€‚ç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBï¼Œåˆ†åˆ«æ‰§è¡Œè¿™æ ·çš„ä»£ç ï¼š

| çº¿ç¨‹ |        A        |        B        |
| ---- |:---------------:|:---------------:|
| ä»£ç  | `a = 1; x = b;` | `b = 2; y = a;` |

> [!info]
> å‡è®¾a, bçš„åˆå€¼ä¸º0ã€‚

ç”¨æˆ‘ä»¬ä»¥å¾€çš„æ–¹å¼æ€è€ƒï¼Œå‡è®¾Aå…ˆæ‰§è¡Œï¼ŒBåæ‰§è¡Œã€‚é‚£ä¹ˆxå…ˆå˜æˆbï¼Œä¹Ÿå°±æ˜¯0ï¼Œç„¶åyå˜æˆaï¼Œä¹Ÿå°±æ˜¯1ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœæ˜¯`x = 0, y = 1`ï¼›

å‡è®¾Bå…ˆæ‰§è¡Œï¼ŒAåæ‰§è¡Œï¼ŒåŒç†ï¼Œæœ€å`x = 2, y = 0`ã€‚

ç„¶è€Œï¼Œä»¥ä¸Šçš„è¿™äº›ç»“æœéƒ½æ˜¯å»ºç«‹åœ¨é¡ºåºæ‰§è¡Œçš„æ¡ä»¶ä¸‹çš„ï¼Œå¦‚æœè€ƒè™‘**æŒ‡ä»¤é‡æ’åº**çš„è¯ï¼Œä¼šæœ‰éå¸¸å‡ºä¹æ„æ–™çš„ç»“æœï¼Œæ¯”å¦‚ï¼Œ**xå’Œyæœ€åéƒ½æ˜¯0**ï¼Ÿï¼Ÿï¼Ÿ

æˆ‘ä»¬å…ˆæ¥ç†ä¸€ç†è¿™ä¸¤ä¸ªçº¿ç¨‹åšçš„äº‹æƒ…ã€‚Açº¿ç¨‹å’ŒBçº¿ç¨‹é¦–å…ˆè¯•å›¾å¯¹è‡ªå·±çš„å˜é‡aå’Œbèµ‹å€¼ï¼Œç„¶åç”±åˆ†åˆ«è¯•å›¾è·å–å¯¹æ–¹çš„å˜é‡ï¼šAæƒ³è¦Bçš„bï¼Œè€ŒBæƒ³è¦Açš„aã€‚è¦åˆ°äº†ä¹‹åï¼Œå†åˆ†åˆ«èµ‹å€¼ç»™è‡ªå·±çš„xå’Œyã€‚

é‚£ä¹ˆï¼Œè€ƒè™‘åˆ°ä¹‹å‰çš„JMMæ¨¡å‹ï¼Œæˆ‘ä»¬èƒ½æƒ³åˆ°ï¼Œaå’Œbå…¶å®æ˜¯åˆ†åˆ«ä¿å­˜åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ä¸­ã€‚è€Œæˆ‘ä»¬åˆšåˆšä¹Ÿæåˆ°è¿‡ï¼Œåœ¨åšIOæ“ä½œçš„æ—¶å€™ï¼Œä¼šç”¨åˆ°Cacheä¹‹ç±»çš„ï¼Œä¹Ÿå°±æ˜¯å†™ç¼“å†²åŒºã€‚æ‰€ä»¥å®é™…ä¸Šaå’Œbæ˜¯åˆ†åˆ«ä¿å­˜åœ¨è¿™ä¸¤ä¸ªçº¿ç¨‹çš„å†™ç¼“å†²åŒºé‡Œçš„ï¼š

![[Study Log/java_kotlin_study/resources/Drawing 2023-11-04 17.46.54.excalidraw.png]]

é‚£ä¹ˆè¿™æ ·ä½ å…¶å®ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œå½“Açº¿ç¨‹å’ŒBçº¿ç¨‹è¦æ›´æ”¹aå’Œbçš„å€¼çš„æ—¶å€™ï¼Œå°±æ¶‰åŠåˆ°å¾ˆå¤šå°çš„æ­¥éª¤ã€‚æ‹¿Açº¿ç¨‹æ¥ä¸¾ä¾‹å­ï¼š

1. Açº¿ç¨‹åœ¨BufferAä¸­æŠŠaçš„å€¼**æ›´æ–°**ï¼›
2. å°†BufferAçš„æ–°çš„aå€¼**åŒæ­¥**åˆ°ä¸»å­˜ä¸­ï¼›

è¿™æ ·çš„è¯ï¼ŒAçº¿ç¨‹å¦‚æœæƒ³è¯»å–bçš„å€¼ï¼Œå°±åªèƒ½ä»ä¸»å­˜ä¸­è¯»ã€‚æˆ‘ä»¬å°†è¿™äº›æ“ä½œæ ‡ä¸ªå·ï¼š

![[Study Log/java_kotlin_study/resources/Drawing 2023-11-04 17.53.32.excalidraw.png]]

å¦‚æœè¿™äº›ä»»åŠ¡å®é™…æ‰§è¡Œçš„é¡ºåºæ˜¯ï¼š

$$
1 \rightarrow 3 \rightarrow 4 \rightarrow 6 \rightarrow 2 \rightarrow 5
$$

é‚£ä¹ˆæœ€ç»ˆxå’Œyå°±éƒ½æ˜¯0äº†ã€‚

> [!question]
>  
> ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºå•¥å¯ä»¥æ˜¯3 2ï¼Œä¸ä¸¥æ ¼æŒ‰ç…§2 3æ¥ã€‚è¿™å°±æ˜¯é‡æ’åºçš„åŸç†æ‰€åœ¨å•Šï¼ä½ æƒ³æƒ³ï¼Œå¯¹äºä¸€ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œæˆ‘å…¶å®å¹¶ä¸å…³å¿ƒå…¶å®ƒçº¿ç¨‹å¯¹æ•°æ®çš„æ“ä½œæ˜¯æ€æ ·çš„ã€‚å› æ­¤ï¼Œæˆ‘è¿™ä¸ªaå¯ä»¥æ›´æ–°ä¹Ÿå¯ä»¥ä¸æ›´æ–°ï¼Œå› ä¸º**åæ­£æˆ‘ä¹‹åè¦è¯»å–çš„æ˜¯bè€Œä¸æ˜¯aï¼Œæ‰€ä»¥2å’Œ3å“ªä¸ªå…ˆæ‰§è¡Œå¯¹äºæˆ‘è¿™ä¸ªçº¿ç¨‹æ˜¯ä¸è¦ç´§çš„**ã€‚

åƒæˆ‘ä»¬ä¸Šé¢çš„æ“ä½œï¼Œå…ˆå­˜ä¸€ä¸ªå€¼ï¼ˆaå’Œbï¼‰ï¼Œå†è¯»å–ä¸€ä¸ªå€¼çš„æ“ä½œï¼Œå«åš**Store-Load**æ“ä½œã€‚è€Œå¯¹äºå¤§å¤šæ•°å¤„ç†å™¨ï¼ŒStore-Loadæ“ä½œéƒ½æ˜¯å…è®¸é‡æ’åºçš„ï¼š

![[Study Log/java_kotlin_study/resources/Pasted image 20231104180430.png]]

é‚£ä¹ˆæŒ‰ç€ä¸Šé¢çš„ä¾‹å­ï¼Œå¯¹äºAçº¿ç¨‹æˆ–è€…Bçº¿ç¨‹æ¥è¯´ï¼Œå®ƒåšçš„æ“ä½œå°±æ˜¯ï¼š

```
Store1
Load2
```

ä¸Šé¢çš„è¡¨æ ¼ä¸­å±•ç¤ºå‡ºæ¥çš„æŒ‡ä»¤ï¼Œéƒ½æ˜¯æœ‰å¯è§æ€§çš„é—®é¢˜çš„ã€‚ä¸ºäº†è§£å†³ï¼ŒJavaç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨ä¸­é—´æ’å…¥ä¸€ä¸ªå†…å­˜å±éšœã€‚æ¯”å¦‚Store-LoadæŒ‡ä»¤çš„å†…å­˜å±éšœå°±å«åšStoreLoadã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ç¼–è¯‘å‡ºæ¥çš„æŒ‡ä»¤åºåˆ—å°±å˜æˆäº†è¿™æ ·ï¼š

```
Store1
StoreLoad
Load2
```

è¿™æ ·ï¼ŒStoreLoadå°±ä¼šä¿è¯ï¼Œåœ¨Store1æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œ**æ‰€æœ‰çš„StoreæŒ‡ä»¤å’ŒLoadæŒ‡ä»¤éƒ½ä¸èƒ½æ‰§è¡Œ**ã€‚ä¹Ÿå°±ä¸ä¼šå‡ºç°ä¹‹å‰è¯´çš„é‚£ç§éƒ½ä¸º0çš„é—®é¢˜äº†ã€‚

è¿™æ ·çš„æŒ‡ä»¤ï¼Œä¸€å…±æœ‰4ç§ï¼š

![[Study Log/java_kotlin_study/resources/Pasted image 20231104183013.png]]

> <small>StoreLoad Barriers æ˜¯ä¸€ä¸ªâ€œå…¨èƒ½å‹â€çš„å±éšœï¼Œ<mark style="background-color:orange"><font color="black">å®ƒåŒæ—¶å…·æœ‰å…¶ä»– 3 ä¸ªå±éšœçš„æ•ˆæœ</font></mark>ã€‚ç°ä»£çš„å¤šå¤„ç†å™¨å¤§å¤šæ”¯æŒè¯¥å±éšœï¼ˆå…¶ä»–ç±»å‹çš„å±éšœä¸ä¸€å®šè¢«æ‰€æœ‰å¤„ç†å™¨æ”¯æŒï¼‰ã€‚æ‰§è¡Œè¯¥å±éšœå¼€é”€ä¼šå¾ˆæ˜‚è´µï¼Œå› ä¸ºå½“å‰å¤„ç†å™¨é€šå¸¸è¦æŠŠå†™ç¼“å†²åŒºä¸­çš„æ•°æ®å…¨éƒ¨åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼ˆBufferFully Flushï¼‰ã€‚</smalll>

#### 3.1.3 happens-before

è¿™ä¸ªä¸œè¥¿æ¥æºäºJDK1.5å¼€å§‹ä½¿ç”¨çš„æ–°å†…å­˜æ¨¡å‹JSR-133ã€‚å…¶å®å¾ˆå¥½ç†è§£ï¼Œ==A happens-before B==å°±æ˜¯å¿…é¡»Aå…ˆå‘ç”Ÿå®Œï¼ŒBæ‰èƒ½å‘ç”Ÿã€‚

æœ‰äº†è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬æ¥è¯´å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„happens-beforeè§„åˆ™ï¼š

* **é¡ºåºæ‰§è¡Œçš„ç¨‹åº**ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œ==happens-before==è¯¥çº¿ç¨‹ä¸­ä»»æ„åç»­æ“ä½œï¼›
* **Monitoré”è§„åˆ™**ï¼šå¯¹äºä¸€ä¸ªé”çš„è§£é”ï¼Œ==happens-before==å¯¹å®ƒçš„åŠ é”ï¼›
* **volatile**ï¼šå¯¹ä¸€ä¸ªvolatileçš„å†™ï¼Œ==happens-before==ä»»æ„ä¹‹åå¯¹å®ƒçš„è¯»ï¼›
* **ä¼ é€’æ€§**ï¼šå¦‚æœA happens-before Bï¼ŒB happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚

> [!question]
> ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦ä¸è¯´äººè¯ã€‚æ¯”å¦‚volatileï¼Œæˆ‘ç›´æ¥â€œå…ˆå†™åè¯»â€å°±è¡Œäº†å‘—ï¼å®é™…ä¸Šï¼Œ**è¿˜çœŸä¸ä¸€å®šæ˜¯å…ˆå†™åè¯»**ï¼
> 
> ä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰ happens-before å…³ç³»ï¼Œ***==å¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œ==***ï¼happens-before ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before thesecondï¼‰ã€‚happens-before çš„å®šä¹‰å¾ˆå¾®å¦™ï¼Œåæ–‡ä¼šå…·ä½“è¯´æ˜ happens-before ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå®šä¹‰ã€‚
> 
> ä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹è¿™é‡Œï¼š[[Study Log/java_kotlin_study/concurrency_art/3_2_reorder#3.2.3 ç¨‹åºé¡ºåºè§„åˆ™|3_2_reorder]]

happens-beforeæ˜¯ç›´æ¥æä¾›ç»™ç¨‹åºå‘˜çœ‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºå‘˜ç”¨çš„å°±æ˜¯happens-beforeè§„åˆ™ï¼Œè€Œè¿™ä¸ªè§„åˆ™å…·ä½“çš„å®ç°å°±æ¥è‡ªJMMï¼Œä¹ŸåŒ…æ‹¬ä¸Šé¢è¯´çš„ä»€ä¹ˆStoreLoadè¿™ç§å±éšœæŒ‡ä»¤ï¼ˆå¤§æ¦‚åŒ…æ‹¬ï¼‰ã€‚

![[Study Log/java_kotlin_study/resources/Pasted image 20231104185527.png|550]]

---

```dataviewjs
const pages = dv.pages('"Study Log/java_kotlin_study/concurrency_art"')
let nextChapterHead = undefined
let res = undefined
const current = dv.current()
for (let page of pages) {
	if (page.chapter_root == true && page.order == Number(current.chapter) + 1) {
		console.log("found next head: " + page.name)
		nextChapterHead = page
		continue
	}
	if (page.chapter == undefined || page.chapter != current.chapter) {
		console.log("not current chapter: " + page.file.name)
		continue
	}
	if (page.order == Number(current.order) + 1) {
		res = page
	}
}
console.log("res: " + res)
console.log("next: " + nextChapterHead)
if (res == undefined) {
	res = nextChapterHead
}
let text = ""
if (res != undefined) {
	const path = res.file.path
	const title = res.title
	const decoLink = "[[" + path + "|" + title + "]]"
	text = "Next Article: " + decoLink
} else {
	text = "æ—…é€”çš„ç»ˆç‚¹ï¼"
}
dv.el("p", text, { attr: { align: "right" } })
```